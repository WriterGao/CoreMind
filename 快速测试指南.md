# CoreMind 新功能快速测试指南

## 🚀 访问地址

- **前端页面**: http://localhost:5173
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

## 🔑 登录账号

```
用户名: coremind
密码: coremind123
```

---

## 📱 页面导航

登录后，您将在左侧看到新增的两个菜单项：

1. **⚙️ LLM配置** - 配置大语言模型
2. **🤖 AI助手** - 创建和管理AI助手

---

## 🎯 测试步骤

### 第一步：配置LLM模型

1. 点击左侧菜单 **"LLM配置"**
2. 点击右上角 **"➕ 添加配置"** 按钮
3. 填写配置信息：

**测试用配置（无需真实API密钥）：**
```
配置名称: 测试GPT配置
提供商: OpenAI (GPT-3.5/4)
模型名称: gpt-4
API密钥: sk-test-key-123456 (测试用)
Temperature: 0.7
Max Tokens: 2000
☑ 设为默认配置
```

4. 点击 **"保存"**
5. 查看配置卡片，应该显示：
   - ✅ 已配置API密钥
   - 状态为"启用"
   - 带有"默认"标签

---

### 第二步：创建AI助手

1. 点击左侧菜单 **"AI助手"**
2. 点击右上角 **"➕ 创建助手"** 按钮
3. 填写助手信息：

**示例1: 全能助手**
```
助手名称: 全能助手
助手描述: 可以回答问题、查询数据和执行操作
LLM配置: 选择刚才创建的"测试GPT配置"
系统提示词: 你是一个全能AI助手，可以回答问题、查询数据和执行各种操作。

功能配置:
☑ 启用知识库检索 (勾选所有可用知识库)
☑ 启用数据源查询 (勾选所有可用数据源)
☑ 启用接口调用 (勾选所有可用接口)
☑ 启用智能路由

最大历史消息数: 10
☑ 设为默认助手
```

4. 点击 **"保存"**
5. 查看助手卡片，应该显示：
   - "默认助手"标签
   - 智能路由: ✅ 启用
   - 三个功能模块徽章（知识库、数据源、接口）

---

### 第三步：查看数据源（新增字段）

1. 点击左侧菜单 **"数据源"**
2. 如果有现有数据源，点击 **"编辑"**
3. 您会看到新增的字段：
   - **使用规范文档**
   - **结构信息（JSON）**
   - **使用示例（JSON）**

**示例数据源配置：**

使用规范文档：
```
这是一个用户数据库，包含以下表：
1. users - 用户信息表
2. orders - 订单表
查询时请注意性能优化，避免全表扫描。
```

结构信息（JSON）：
```json
{
  "tables": [
    {
      "name": "users",
      "columns": [
        {"name": "id", "type": "uuid"},
        {"name": "username", "type": "varchar(50)"}
      ]
    }
  ]
}
```

使用示例（JSON）：
```json
[
  {
    "description": "查询用户总数",
    "query": "SELECT COUNT(*) FROM users"
  }
]
```

---

### 第四步：测试智能路由（通过API）

使用Postman或curl测试新的聊天API：

**1. 获取Token**
```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=coremind&password=coremind123"
```

**2. 测试智能聊天（知识库查询）**
```bash
curl -X POST http://localhost:8000/api/v1/chat-v2/chat \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "什么是RESTful API？"
  }'
```

**响应示例：**
```json
{
  "conversation_id": "...",
  "message_id": "...",
  "role": "assistant",
  "content": "根据您的问题，我进行了以下分析：...",
  "route_info": {
    "route_type": "knowledge_base",
    "confidence": 0.92,
    "reason": "检测到知识查询意图，使用知识库检索",
    "services": [...]
  }
}
```

**3. 测试智能聊天（数据查询）**
```bash
curl -X POST http://localhost:8000/api/v1/chat-v2/chat \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "查询最近7天的订单统计"
  }'
```

**响应示例：**
```json
{
  "route_info": {
    "route_type": "datasource",
    "confidence": 0.88,
    "reason": "检测到数据查询意图，使用数据源查询",
    "services": [...]
  }
}
```

---

## ✅ 验证清单

完成以下检查，确认所有功能正常：

### LLM配置页面
- [ ] 能看到"LLM配置"菜单
- [ ] 能打开配置页面
- [ ] 能看到11种提供商列表
- [ ] 能创建新配置
- [ ] 能编辑现有配置
- [ ] 能删除配置
- [ ] 默认配置有蓝色边框标识
- [ ] API密钥显示为"已配置"而不是明文

### AI助手页面
- [ ] 能看到"AI助手"菜单
- [ ] 能打开助手页面
- [ ] 能创建新助手
- [ ] 能选择LLM配置
- [ ] 能选择知识库、数据源、接口
- [ ] 能启用/禁用智能路由
- [ ] 能编辑现有助手
- [ ] 能删除助手
- [ ] 默认助手有标识

### 数据源页面
- [ ] 能看到新增的"使用规范文档"字段
- [ ] 能看到"结构信息"字段
- [ ] 能看到"使用示例"字段
- [ ] 能保存带有这些字段的数据源

### API测试
- [ ] `/api/v1/llm-configs/providers/list` 返回11种提供商
- [ ] 能创建LLM配置
- [ ] 能创建AI助手
- [ ] `/api/v1/chat-v2/chat` 返回路由信息
- [ ] 路由能识别知识库查询
- [ ] 路由能识别数据查询

---

## 🐛 常见问题

### 1. 看不到新菜单？
- 刷新页面（Ctrl/Cmd + R）
- 清除浏览器缓存
- 重新登录

### 2. API报错？
- 检查后端服务是否运行：`curl http://localhost:8000/health`
- 检查Token是否有效
- 查看后端日志：`tail -f backend.log`

### 3. 前端页面空白？
- 检查前端服务：`ps aux | grep vite`
- 查看前端日志：`tail -f frontend/frontend.log`
- 查看浏览器控制台错误

---

## 📊 测试数据

### 支持的LLM提供商

1. OpenAI (GPT-3.5/4/4o)
2. Azure OpenAI
3. DeepSeek
4. 阿里云通义千问
5. 智谱AI (ChatGLM)
6. 百度文心一言
7. 月之暗面 (Kimi)
8. Anthropic (Claude)
9. Google Gemini
10. Ollama (本地部署)
11. 自定义

### 智能路由关键词测试

**知识库关键词：**
- "什么是..."
- "介绍一下..."
- "解释..."
- "如何..."

**数据查询关键词：**
- "查询..."
- "统计..."
- "多少..."
- "最新..."

**接口调用关键词：**
- "创建..."
- "删除..."
- "更新..."
- "执行..."

---

## 🎉 测试完成

如果所有检查项都通过，恭喜！所有新功能已正常工作。

**下一步：**
1. 配置真实的LLM API密钥
2. 创建适合您业务的助手
3. 为数据源添加详细的使用规范
4. 开始与AI助手对话

---

## 📞 需要帮助？

查看详细文档：
- 📘 `docs/新功能使用指南.md`
- 📗 `更新日志.md`
- 📕 `docs/API文档.md`
- 🌐 API文档: http://localhost:8000/docs

